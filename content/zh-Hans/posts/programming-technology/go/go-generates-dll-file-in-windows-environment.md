---
title: Goè¯­è¨€åœ¨windowsç¯å¢ƒä¸‹ç”Ÿæˆdllæ–‡ä»¶
date: 2021-03-31
lastmod: 2021-03-31
draft: false
description: ""
tags:
  - dll
categories:
  - ç¼–ç¨‹æŠ€æœ¯
  - Go
---

# Go è¯­è¨€ windows ç¯å¢ƒä¸‹ç”Ÿæˆ dll æ–‡ä»¶

## æ–‡ç« ç›®å½•

- [Go è¯­è¨€ windows ç¯å¢ƒä¸‹ç”Ÿæˆ dll æ–‡ä»¶](#go-è¯­è¨€-windows-ç¯å¢ƒä¸‹ç”Ÿæˆ-dll-æ–‡ä»¶)
	- [æ–‡ç« ç›®å½•](#æ–‡ç« ç›®å½•)
	- [1. è¿è¡Œç¯å¢ƒ](#1-è¿è¡Œç¯å¢ƒ)
	- [2. å®ç°](#2-å®ç°)
		- [2.1 Go ä»£ç ](#21-go-ä»£ç )
		- [2.2 ç¼–è¯‘](#22-ç¼–è¯‘)
		- [2.3 ç»“æœ](#23-ç»“æœ)
	- [3. è°ƒç”¨](#3-è°ƒç”¨)
		- [3.1 Go è¯­è¨€è°ƒç”¨](#31-go-è¯­è¨€è°ƒç”¨)

> å£°æ˜ï¼šæˆ‘æ˜¯ ã€Œ[ç±³å¸ç‰¹åŒ…](http://misitebao.com)ã€ ï¼Œæœ¬ç¯‡æ–‡ç«  **é¦–å‘** äº
> ã€Œ[ç±³å¸åšå®¢](http://blog.misitebao.com)ã€ ï¼Œå…¶ä»–å¹³å°ä¸ºåŒæ­¥æ¨é€ï¼ˆ_å› ä¸ºå¯èƒ½æ–‡ç« 
> è·¯å¾„ä¼šå˜åŠ¨ï¼Œæ‰€ä»¥å°±æ²¡æ”¾è¯¦ç»†é“¾æ¥ï¼Œè¿›æ¥çš„å¯ä»¥
> [æ ¹æ®æ ‡é¢˜æŸ¥æ‰¾ ğŸ”](http://blog.misitebao.com/posts/)_ï¼‰ã€‚

å› ä¸ºä¹‹å‰å¼€å‘ä¸€ä¸ª Electron é¡¹ç›®ï¼Œé‡Œé¢æœ‰ä¸€ä¸ªåŠŸèƒ½ç”¨åˆ°äº†å¤–éƒ¨çš„ dll æ–‡ä»¶ï¼Œå½“æ—¶è‡ªå·±ä¸
ä¼šå¼€å‘ï¼Œè¿˜æ˜¯æ‰¾çš„å…¶ä»–é¡¹ç›®ç»„çš„åŒäº‹å¸®å¿™å†™çš„ä¸€ä¸ª dll æ–‡ä»¶ï¼Œæœ€è¿‘å¿½ç„¶æƒ³åˆ°è¿™ä¸ªï¼Œè€Œä¸”ç°
åœ¨ç”¨ Go ä¹Ÿæ¯”è¾ƒå¤šï¼Œæ‰€ä»¥å°±æƒ³ç€ç”¨ Go å®ç°ä¸€ä¸‹ï¼ˆå› ä¸ºä¹‹å‰äº†è§£è¿‡ cgoï¼Œä½†æ˜¯æ²¡å®é™…åº”ç”¨è¿‡
ï¼Œä¸»è¦æ˜¯æˆ‘æ¥è§¦çš„é¡¹ç›®å¹¶æ²¡æœ‰åº”ç”¨åœºæ™¯ï¼Œä½†æ˜¯æˆ‘çŸ¥é“ Go å¯ä»¥å®ç°ã€‚ï¼‰ï¼Œå¦‚æœå¯ä»¥çš„è¯ï¼Œä»¥
åå†™é¡¹ç›®å¦‚æœå†éœ€è¦ç”¨åˆ°ï¼Œå°±ä¸ç”¨éº»çƒ¦åˆ«äººäº†ã€‚

**æ–‡ç« é‡Œé¢çš„ç¤ºä¾‹ä»£ç å·²ç»æ”¾åœ¨ Github äº†,ä¸‹è½½åœ°å€ ğŸ‘‡**

- [https://github.com/misitebao/demo-go-dll](https://github.com/misitebao/demo-go-dll)

<span id="nav-1"></span>

## 1. è¿è¡Œç¯å¢ƒ

- windows 10ï¼šç‰ˆæœ¬ Dev ï¼ˆOS å†…éƒ¨ç‰ˆæœ¬ 21343.1000ï¼‰
- go `go version go1.16 windows/amd64`
- gcc `gcc.exe (tdm64-1) 9.2.0`

windows æŸ¥çœ‹ç‰ˆæœ¬ä¿¡æ¯å‘½ä»¤ï¼š`winver`

<span id="nav-2"></span>

## 2. å®ç°

<span id="nav-2-1"></span>

### 2.1 Go ä»£ç 

```go
// go_dll.go
package main

import "C"

//export Add
func Add(a C.int, b C.int) C.int {
	return a + b
}

//export Print
func Print(s *C.char) {

	// å‡½æ•°å‚æ•°å¯ä»¥ç”¨ string, ä½†æ˜¯ç”¨*C.charæ›´é€šç”¨ä¸€äº›ã€‚
	// ç”±äºstringçš„æ•°æ®ç»“æ„ï¼Œæ˜¯å¯ä»¥è¢«å…¶å®ƒgoç¨‹åºè°ƒç”¨çš„ï¼Œ
	// ä½†å…¶å®ƒè¯­è¨€ï¼ˆå¦‚ nodejsï¼‰å°±ä¸è¡Œäº†

	print("Hello ", C.GoString(s)) //è¿™é‡Œä¸èƒ½ç”¨fmtåŒ…ï¼Œä¼šæŠ¥é”™ï¼Œè°ƒäº†å¾ˆä¹…...
}

func main() {
}

```

<span id="nav-2-2"></span>

### 2.2 ç¼–è¯‘

```shell
go build -ldflags "-s -w" -buildmode=c-shared -o demo_go_dll.dll go_dll.go
```

<span id="nav-2-3"></span>

### 2.3 ç»“æœ

ç”Ÿæˆ .dll å’Œ .h æ–‡ä»¶

![image-20210331125052548](https://cdn.jsdelivr.net/gh/misitebao/CDN/md/image-20210331125052548.png)

<span id="nav-3"></span>

## 3. è°ƒç”¨

<span id="nav-3-1"></span>

### 3.1 Go è¯­è¨€è°ƒç”¨

![image-20210331133106311](https://cdn.jsdelivr.net/gh/misitebao/CDN/md/image-20210331133106311.png)

è¾“å‡º:

![image-20210331141251300](https://cdn.jsdelivr.net/gh/misitebao/CDN/md/image-20210331141251300.png)

è¿™åªæ˜¯ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œå®ç°åŸºæœ¬çš„è¿ç®—å’Œè¾“å‡ºï¼Œè€Œä¸”ä¹Ÿåªæ˜¯åœ¨ Go é‡Œé¢è°ƒç”¨æµ‹è¯•ï¼Œåç»­è¿˜
è¦æµ‹è¯•åœ¨ node é‡Œé¢è°ƒç”¨æµ‹è¯•ï¼Œè¿˜è¦æµ‹è¯•æ›´åŠ å¤æ‚çš„åŠŸèƒ½ã€‚

å…³äº node è°ƒç”¨ dll çš„æ–‡ç« ï¼Œå¯ä»¥åœ¨ node åˆ†ç±»é‡Œé¢æŸ¥æ‰¾
